<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://example.com/loading-data/continuously-loading-data/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Continuously loading data tutorial - Firebolt docs process</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Firebolt docs process</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../.." class="nav-link">Getting started</a>
                            </li>
                            <li class="navitem">
                                <a href="../../architecture-overview/" class="nav-link">Architecture overview</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Working with engines <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="/working-with-engines/understanding-engine-fundamentals.md" class="dropdown-item">Understanding engine fundamentals</a>
</li>
                                    
<li>
    <a href="/working-with-engines/working-with-engines-using-ddl.md" class="dropdown-item">Working with engines using DDL</a>
</li>
                                    
<li>
    <a href="/working-with-engines/working-with-engines-using-the-rest-api.md" class="dropdown-item">Working with engines using the REST API</a>
</li>
                                    
<li>
    <a href="/working-with-engines/working-with-engines-using-the-firebolt-manager.md" class="dropdown-item">Working with engines using the Firebolt Manager</a>
</li>
                                    
<li>
    <a href="/working-with-engines/tuning-engine-performance.md" class="dropdown-item">Tuning engine performance</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Concepts <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="/concepts/working-with-tables.md" class="dropdown-item">Working with tables</a>
</li>
                                    
<li>
    <a href="/concepts/get-instant-query-response-time.md" class="dropdown-item">Using indexes</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Working with semi-structured data</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="/concepts/working-with-semi-structured-data/README.md" class="dropdown-item">Overview</a>
</li>
            
<li>
    <a href="/concepts/working-with-semi-structured-data/working-with-arrays.md" class="dropdown-item">Working with arrays</a>
</li>
            
<li>
    <a href="/concepts/working-with-semi-structured-data/ingesting-semi-structured-data.md" class="dropdown-item">Ingesting semi-structured data</a>
</li>
            
<li>
    <a href="/concepts/working-with-semi-structured-data/working-with-parquet-arrays-of-structs-and-maps.md" class="dropdown-item">Working with Parquet arrays and maps</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Writing, editing, and running SQL <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="/working-with-our-sql-editor/README.md" class="dropdown-item">Working with the SQL workspace</a>
</li>
                                    
<li>
    <a href="/working-with-our-sql-editor/keyboard-shortcuts-for-sql-workspace.md" class="dropdown-item">Keyboard shortcuts</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Loading data <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="/loading-data/loading-data-into-firebolt.md" class="dropdown-item">-Working with external tables</a>
</li>
                                    
<li>
    <a href="/loading-data/continuously-loading-data.md" class="dropdown-item">-Incrementally loading data tutorial</a>
</li>
                                    
<li>
    <a href="/loading-data/configuring-aws-role-access-amazon-s3.md" class="dropdown-item">-Using AWS roles to access Amazon S3</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="/integrations/integration-overview.md" class="nav-link">Integrations overview</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#continuously-loading-data-tutorial" class="nav-link">Continuously loading data tutorial</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#pre-requisites" class="nav-link">Pre-requisites</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#step-1-setup-an-airflow-connection-to-firebolt" class="nav-link">Step 1: Setup an Airflow connection to Firebolt</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#step-2-create-a-dag-for-continuously-loading-data-into-firebolt" class="nav-link">Step 2: Create a DAG for continuously loading data into Firebolt</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#step-3-run-the-dag" class="nav-link">Step 3: Run the DAG</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="continuously-loading-data-tutorial">Continuously loading data tutorial</h1>
<p>This tutorial describes the steps for continuously loading data into Firebolt. In order to continuously load the data into Firebolt, we need to schedule the loading workflow. In order to achieve that, in this guide, we are using Apache Airflow which is a platform that enables to programmatically schedule and monitor workflows.</p>
<h2 id="pre-requisites">Pre-requisites</h2>
<p>Before we start, make sure you have the following in-place:</p>
<ol>
<li>An active Firebolt account.</li>
<li>Apache Airflow up and running.</li>
<li>A database. Follow the <a href="../#create-your-first-database">create your first database</a> section in the <a href="../">getting started tutorial</a>.</li>
<li>An external table. Follow <a href="../#step-1-create-an-external-table">step 1 - create an external table</a> in the <a href="../">getting started tutorial</a>.</li>
<li>A fact or dimension table to load your data into. In this tutorial, we have chosen to create a fact table. Continuously loading data into a dimension table is similar. On top of the columns required in the table's schema - make sure to add the following columns as well: <code>SOURCE_FILE_NAME</code> of type<code>TEXT</code>, and<code>SOURCE_FILE_TIMESTAMP</code> of type <code>TIMESTAMP</code>. Run the following command on the database created in step 1 in order to create the fact table required for this tutorial:</li>
</ol>
<pre><code class="language-sql">CREATE FACT TABLE IF NOT EXISTS lineitem_detailed
(       l_orderkey              LONG,
        l_partkey               LONG,
        l_suppkey               LONG,
        l_linenumber            INT,
        l_quantity              LONG,
        l_extendedprice         LONG,
        l_discount              LONG,
        l_tax                   LONG,
        l_returnflag            TEXT,
        l_linestatus            TEXT,
        l_shipdate              TEXT,
        l_commitdate            TEXT,
        l_receiptdate           TEXT,
        l_shipinstruct          TEXT,
        l_shipmode              TEXT,
        l_comment               TEXT,
        source_file_name        TEXT, -- required for cont. loading data
        source_file_timestamp   TIMESTAMP -- required for cont. loading data
) PRIMARY INDEX l_orderkey, l_linenumber;
</code></pre>
<h2 id="step-1-setup-an-airflow-connection-to-firebolt">Step 1: Setup an Airflow connection to Firebolt</h2>
<p>Apache Airflow supports several kinds of connectors. In this tutorial, we use the JDBC connector.</p>
<p>Perform the following steps in our <a href="../../integrations/other-integrations/setting-up-airflow-jdbc-to-firebolt/">setting up Airflow JDBC to Firebolt</a> guide:</p>
<ul>
<li>Install the latest Firebolt JDBC driver in Airflow - read more <a href="../../integrations/other-integrations/setting-up-airflow-jdbc-to-firebolt/#step-1-install-the-latest-firebolt-jdbc-driver">here</a>.</li>
<li>Setup the JDBC connection to Firebolt in Airflow - read more <a href="../../integrations/other-integrations/setting-up-airflow-jdbc-to-firebolt/#step-2-setup-the-jdbc-connection-in-airflow">here</a>. In this guide, we assume the <code>Conn ID</code> is <code>Firebolt</code>.</li>
</ul>
<h2 id="step-2-create-a-dag-for-continuously-loading-data-into-firebolt">Step 2: Create a DAG for continuously loading data into Firebolt</h2>
<p>Apache Airflow supports running DAG scripts written in Python. Below is a script that enables to continuously load data into Firebolt:</p>
<pre><code class="language-sql">from airflow import DAG
from airflow.operators.jdbc_operator import JdbcOperator

default_arg = {'owner': 'airflow', 'start_date': '2020-10-20'}

dag = DAG('firebolt_continuous_load_dag',
          default_args=default_arg,
          schedule_interval='* * * * *')

data_load = JdbcOperator(dag=dag,
jdbc_conn_id='firebolt',
task_id='data_ingestion',
sql=['INSERT INTO lineitem_detailed SELECT *, source_file_name, source_file_timestamp FROM ex_lineitem WHERE source_file_timestamp &gt; ( SELECT MAX(source_file_timestamp) FROM lineitem_detailed )'])

data_load
</code></pre>
<h3 id="load-command">Load command</h3>
<p>The script contains a single step called <code>data_load</code>. It connects to a database in Firebolt via a JDBC connector and runs the following <a href="../../sql-reference/commands/dml-commands/#insert-into">INSERT INTO</a> command:</p>
<pre><code class="language-sql">INSERT INTO lineitem_detailed SELECT *, source_file_name, source_file_timestamp
FROM ex_lineitem
WHERE source_file_timestamp &gt; ( SELECT MAX(source_file_timestamp) FROM lineitem_detailed )
</code></pre>
<p>We use the <code>SOURCE_FILE_NAME</code> and <code>SOURCE_FILE_TIMESTAMP</code> external table metadata column to decide which files to load into Firebolt. We load only the new files that were added to S3 based on the <code>SOURCE_FILE_TIMESTAMP</code> column.</p>
<h3 id="scheduling">Scheduling</h3>
<p>Airflow scheduler can run each DAG according to a predefined schedule. The schedule is being determined by the<code>schedule_interval</code> DAG parameter. It supports either a <a href="https://en.wikipedia.org/wiki/Cron#CRON_expression">cron expression</a> or several predefined intervals (read more in the <a href="https://airflow.apache.org/docs/apache-airflow/1.10.1/scheduler.html">Airflow documentation</a>). We have set it to <code>'* * * * *'</code> using a cron expression which instructs the Airflow scheduler to run the DAG every 1 minute.</p>
<h2 id="step-3-run-the-dag">Step 3: Run the DAG</h2>
<ul>
<li>In Airflow's UI, go to the <strong>DAGs</strong> tab. Locate your DAG in the list (in our case we should look for <code>'firebolt_continuous_load_dag'</code>):</li>
</ul>
<p><img alt="" src="../.gitbook/assets/Screen Shot 2021-01-12 at 11.15.25.png" /></p>
<ul>
<li>Turn the DAG on so it runs automatically every minute.</li>
</ul>
<p><img alt="" src="../.gitbook/assets/screen-shot-2021-01-12-at-11.14.01 (1).png" /></p>
<ul>
<li>Once the DAG has started to run, click on it's <code>Run Id</code> under the <code>Last Run</code> column to move to the graph view and track its progress.</li>
<li>In the DAG's graph view, the task should appear in green to confirm the DAG was completed successfully. Click on the task <code>'data_load'</code>:</li>
</ul>
<p><img alt="" src="../.gitbook/assets/Screen Shot 2021-01-12 at 11.20.02.png" /></p>
<ul>
<li>Click on <strong>View Logs</strong> to inspect the logs.</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
